# 🚀 宝塔 Docker 部署说明

## 📚 文档说明

本项目提供了**多种快速部署方案**，包含以下文档和脚本：

> 💡 **快速选择**：查看 [`所有部署方式汇总.md`](./所有部署方式汇总.md) 选择最适合你的方案

### 📄 文档文件

1. **宝塔Docker部署完整指南.md** - 详细的部署教程（推荐先看）
   - 包含完整的步骤说明
   - 详细的配置说明
   - 故障排除指南
   - 安全建议

2. **宝塔部署快速参考.md** - 快速参考手册
   - 常用命令速查
   - 快速配置指南
   - 常见问题速查

3. **宝塔部署说明.md** - 本文档
   - 文档索引
   - 快速开始

### 🔧 脚本文件

1. **install.sh** - 一键安装脚本
   - 自动检查环境
   - 自动生成配置
   - 自动构建和启动

2. **deploy.sh** - 部署脚本
   - 快速部署已配置的项目

3. **check-bt-deploy.sh** - 环境检查脚本
   - 检查 Docker 环境
   - 检查配置文件
   - 检查端口占用
   - 检查资源使用

4. **一键远程部署.sh** - 一键远程部署脚本（最快速）
   - 从 GitHub 直接拉取代码
   - 自动安装 Docker
   - 自动配置环境
   - 自动部署

## ⚡ 快速开始

### 🚀 方式0：一键远程部署（最快 - 5分钟）

```bash
# 在服务器上直接运行（从 GitHub 拉取并自动部署）
curl -fsSL https://raw.githubusercontent.com/你的用户名/nexus-agent-orchestrator/main/一键远程部署.sh | bash

# 或下载后运行
wget https://raw.githubusercontent.com/你的用户名/nexus-agent-orchestrator/main/一键远程部署.sh
chmod +x 一键远程部署.sh
./一键远程部署.sh
```

**特点**：
- ✅ 自动从 GitHub 拉取代码
- ✅ 自动安装 Docker（如果未安装）
- ✅ 自动生成配置
- ✅ 自动部署

### 方式1：使用一键安装脚本（推荐新手）

```bash
# 1. 上传项目到 /www/wwwroot/nexus-agent

# 2. 进入项目目录
cd /www/wwwroot/nexus-agent

# 3. 运行环境检查
chmod +x check-bt-deploy.sh
./check-bt-deploy.sh

# 4. 运行一键安装
chmod +x install.sh
./install.sh
```

### 方式2：手动部署（推荐有经验用户）

```bash
# 1. 进入项目目录
cd /www/wwwroot/nexus-agent

# 2. 配置环境变量
cp env.prod.example .env.prod
nano .env.prod  # 修改必要配置

# 3. 构建和启动
docker-compose -f docker-compose.prod.yml --env-file .env.prod up -d --build

# 4. 运行数据库迁移
docker-compose -f docker-compose.prod.yml exec -T backend npm run migrate
```

## 📋 部署步骤概览

1. ✅ **准备环境** - 安装 Docker 和 Docker Compose
2. ✅ **上传项目** - 将项目上传到服务器
3. ✅ **配置环境变量** - 编辑 `.env.prod` 文件
4. ✅ **运行部署** - 执行安装脚本或手动部署
5. ✅ **配置反向代理** - 在宝塔中配置网站和反向代理
6. ✅ **配置 SSL** - 申请并配置 HTTPS 证书
7. ✅ **验证部署** - 检查服务是否正常运行

## 🔍 环境检查

在部署前，建议先运行环境检查脚本：

```bash
chmod +x check-bt-deploy.sh
./check-bt-deploy.sh
```

这个脚本会检查：
- ✅ Docker 和 Docker Compose 是否安装
- ✅ 项目文件是否完整
- ✅ 环境变量配置是否正确
- ✅ 端口是否被占用
- ✅ 磁盘空间和内存是否充足
- ✅ 容器运行状态

## 📝 必须配置的项

在 `.env.prod` 文件中，以下配置**必须修改**：

1. **POSTGRES_PASSWORD** - 数据库密码（使用强密码）
2. **JWT_SECRET** - JWT 密钥（至少32位随机字符串）
3. **GEMINI_API_KEY** - Gemini API 密钥（必须配置）

可选但推荐的配置：

4. **VITE_API_URL** - 如果有域名，配置为 `https://你的域名/api`
5. **CORS_ORIGIN** - 如果有域名，配置为 `https://你的域名`

## 🌐 宝塔反向代理配置

### 基本配置

1. 在宝塔中创建网站
2. 配置反向代理：
   - **代理名称**：nexus-frontend
   - **目标URL**：`http://127.0.0.1:80`
   - **发送域名**：`$host`

### 详细配置

请参考 **宝塔Docker部署完整指南.md** 中的"第五步：配置宝塔反向代理"部分。

## 🔒 SSL 证书配置

1. 在网站设置中进入 **SSL** 标签
2. 选择 **Let's Encrypt**
3. 填写邮箱并申请证书
4. 开启 **强制 HTTPS**
5. 更新 `.env.prod` 中的 `VITE_API_URL` 和 `CORS_ORIGIN` 为 HTTPS
6. 重启前端容器：`docker-compose -f docker-compose.prod.yml restart frontend`

## 📊 常用命令

### 查看服务状态
```bash
cd /www/wwwroot/nexus-agent
docker-compose -f docker-compose.prod.yml ps
```

### 查看日志
```bash
# 所有服务
docker-compose -f docker-compose.prod.yml logs -f

# 特定服务
docker-compose -f docker-compose.prod.yml logs -f backend
```

### 重启服务
```bash
docker-compose -f docker-compose.prod.yml restart
```

### 更新代码
```bash
git pull
docker-compose -f docker-compose.prod.yml --env-file .env.prod up -d --build
```

更多命令请参考 **宝塔部署快速参考.md**。

## 🐛 遇到问题？

1. **先运行环境检查**：`./check-bt-deploy.sh`
2. **查看日志**：`docker-compose -f docker-compose.prod.yml logs`
3. **查看完整文档**：`宝塔Docker部署完整指南.md` 中的"故障排除"部分
4. **检查服务状态**：`docker-compose -f docker-compose.prod.yml ps`

## 🎯 其他部署方式

除了宝塔部署，还有以下快速部署方案：

1. **☁️ 云平台一键部署**（最简单）
   - Railway、Vercel、Render 等
   - 查看：`云平台一键部署.md`
   - 时间：5-10 分钟

2. **⚡ PM2 直接部署**（不用 Docker）
   - 轻量级，启动快
   - 查看：`PM2部署方案.md`
   - 时间：15 分钟

3. **📋 所有方案汇总**
   - 查看：`所有部署方式汇总.md`
   - 选择最适合你的方案

## 📞 获取帮助

- 📖 详细文档：`宝塔Docker部署完整指南.md`
- ⚡ 快速参考：`宝塔部署快速参考.md`
- 🔍 环境检查：`./check-bt-deploy.sh`
- 📋 所有方案：`所有部署方式汇总.md`

## ✅ 部署检查清单

部署完成后，请确认：

- [ ] 所有容器正常运行：`docker-compose -f docker-compose.prod.yml ps`
- [ ] 前端可以访问：`http://你的域名`
- [ ] 后端健康检查通过：`http://你的域名/api/health`
- [ ] 数据库连接正常：查看后端日志
- [ ] SSL 证书已配置（如果使用 HTTPS）
- [ ] 反向代理配置正确

## 🎉 完成！

部署成功后，你就可以开始使用 Nexus Agent Orchestrator 了！

---

**提示**：建议将本文档和 `宝塔部署快速参考.md` 保存为书签，方便随时查阅。










