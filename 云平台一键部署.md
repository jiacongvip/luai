# ☁️ 云平台一键部署方案

这些方案可以让你在几分钟内完成部署，无需管理服务器。

## 🚀 方案对比

| 平台 | 免费额度 | 部署难度 | 推荐度 |
|------|---------|---------|--------|
| **Railway** | 每月 $5 免费额度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Vercel + Railway** | 完全免费 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Render** | 免费（有限制） | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Fly.io** | 免费 | ⭐⭐⭐ | ⭐⭐⭐ |
| **DigitalOcean App Platform** | 有免费试用 | ⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 🎯 方案一：Railway（推荐 - 最简单）

Railway 可以同时部署前端、后端和数据库，一键完成。

### 部署步骤

1. **访问 Railway**
   - 打开 https://railway.app
   - 使用 GitHub 账号登录

2. **创建新项目**
   - 点击 "New Project"
   - 选择 "Deploy from GitHub repo"
   - 选择你的仓库

3. **添加服务**
   - 点击 "+ New" → "Database" → "PostgreSQL"
   - Railway 会自动创建数据库

4. **部署后端**
   - 点击 "+ New" → "GitHub Repo"
   - 选择仓库，根目录设置为 `backend`
   - 添加环境变量：
     ```
     DATABASE_URL=${{Postgres.DATABASE_URL}}
     JWT_SECRET=你的JWT密钥
     GEMINI_API_KEY=你的API密钥
     CORS_ORIGIN=https://你的前端域名
     PORT=3001
     NODE_ENV=production
     ```
   - Railway 会自动检测并部署

5. **部署前端**
   - 点击 "+ New" → "GitHub Repo"
   - 选择仓库，根目录设置为 `.`（项目根目录）
   - 添加环境变量：
     ```
     VITE_API_URL=https://你的后端域名/api
     ```
   - 构建命令：`npm run build`
   - 输出目录：`dist`

6. **配置域名**
   - 在服务设置中点击 "Generate Domain"
   - 或绑定自定义域名

**完成！** Railway 会自动处理所有部署流程。

---

## 🎯 方案二：Vercel（前端）+ Railway（后端）

这是最流行的组合，前端用 Vercel（免费且快速），后端用 Railway。

### 前端部署（Vercel）

1. **访问 Vercel**
   - 打开 https://vercel.com
   - 使用 GitHub 账号登录

2. **导入项目**
   - 点击 "Add New" → "Project"
   - 选择你的 GitHub 仓库
   - 配置：
     - Framework Preset: `Vite`
     - Root Directory: `.`（项目根目录）
     - Build Command: `npm run build`
     - Output Directory: `dist`
     - Install Command: `npm install`

3. **环境变量**
   ```
   VITE_API_URL=https://你的后端域名/api
   ```

4. **部署**
   - 点击 "Deploy"
   - 等待 1-2 分钟完成

### 后端部署（Railway）

按照方案一的步骤 1-4 部署后端。

**完成！** 前端和后端都已部署。

---

## 🎯 方案三：Render（全栈）

Render 提供免费的全栈部署服务。

### 部署步骤

1. **访问 Render**
   - 打开 https://render.com
   - 使用 GitHub 账号登录

2. **部署数据库**
   - 点击 "New +" → "PostgreSQL"
   - 选择免费计划
   - 创建数据库

3. **部署后端**
   - 点击 "New +" → "Web Service"
   - 连接 GitHub 仓库
   - 配置：
     - Name: `nexus-backend`
     - Root Directory: `backend`
     - Environment: `Node`
     - Build Command: `npm install && npm run build`
     - Start Command: `npm start`
   - 环境变量：
     ```
     DATABASE_URL=你的数据库连接URL
     JWT_SECRET=你的JWT密钥
     GEMINI_API_KEY=你的API密钥
     CORS_ORIGIN=https://你的前端域名
     PORT=3001
     NODE_ENV=production
     ```

4. **部署前端**
   - 点击 "New +" → "Static Site"
   - 连接 GitHub 仓库
   - 配置：
     - Build Command: `npm install && npm run build`
     - Publish Directory: `dist`
   - 环境变量：
     ```
     VITE_API_URL=https://你的后端域名/api
     ```

**完成！** Render 会自动部署。

---

## 🎯 方案四：Fly.io（免费）

Fly.io 提供全球边缘部署。

### 部署步骤

1. **安装 Fly CLI**
   ```bash
   curl -L https://fly.io/install.sh | sh
   ```

2. **登录**
   ```bash
   fly auth login
   ```

3. **部署后端**
   ```bash
   cd backend
   fly launch
   # 按提示配置
   fly deploy
   ```

4. **部署前端**
   ```bash
   cd ..
   fly launch
   fly deploy
   ```

---

## 🎯 方案五：一键脚本部署到 VPS

如果你有 VPS，可以使用一键脚本：

```bash
# 从 GitHub 直接部署
curl -fsSL https://raw.githubusercontent.com/你的用户名/nexus-agent-orchestrator/main/一键远程部署.sh | bash
```

或者：

```bash
# 下载并运行
wget https://raw.githubusercontent.com/你的用户名/nexus-agent-orchestrator/main/一键远程部署.sh
chmod +x 一键远程部署.sh
./一键远程部署.sh
```

---

## 📊 各方案对比

### Railway
- ✅ **优点**：最简单，自动配置，支持数据库
- ❌ **缺点**：免费额度有限
- 💰 **价格**：每月 $5 免费额度

### Vercel + Railway
- ✅ **优点**：前端完全免费，CDN 加速
- ❌ **缺点**：需要配置两个平台
- 💰 **价格**：前端免费，后端 Railway

### Render
- ✅ **优点**：免费计划可用，简单
- ❌ **缺点**：免费计划有休眠限制
- 💰 **价格**：免费（有限制）

### Fly.io
- ✅ **优点**：全球边缘部署，免费
- ❌ **缺点**：配置稍复杂
- 💰 **价格**：免费

---

## 🔧 环境变量配置

### 后端环境变量

```env
DATABASE_URL=postgresql://user:pass@host:port/db
JWT_SECRET=至少32位随机字符串
JWT_EXPIRES_IN=7d
GEMINI_API_KEY=你的Gemini API密钥
CORS_ORIGIN=https://你的前端域名
PORT=3001
NODE_ENV=production
```

### 前端环境变量

```env
VITE_API_URL=https://你的后端域名/api
```

---

## 🎉 推荐方案

**新手推荐**：Railway（最简单）
**预算有限**：Vercel + Railway（前端免费）
**需要全球加速**：Fly.io
**需要更多控制**：VPS + Docker

---

## 📝 部署后检查

1. ✅ 前端可以访问
2. ✅ 后端健康检查通过：`https://你的后端域名/health`
3. ✅ API 可以调用：`https://你的后端域名/api/health`
4. ✅ 数据库连接正常
5. ✅ SSL 证书已配置（HTTPS）

---

## 🐛 常见问题

### Railway 部署失败
- 检查环境变量是否正确
- 查看构建日志
- 确认数据库连接字符串格式

### Vercel 构建失败
- 检查 `package.json` 中的构建脚本
- 确认输出目录为 `dist`
- 查看构建日志

### 前后端无法通信
- 检查 CORS 配置
- 确认 `VITE_API_URL` 正确
- 检查防火墙规则

---

**选择最适合你的方案，开始部署吧！** 🚀

