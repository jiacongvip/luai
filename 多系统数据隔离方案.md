# ğŸ”’ å¤šç³»ç»Ÿæ•°æ®éš”ç¦»æ–¹æ¡ˆ

## âš ï¸ é—®é¢˜è¯´æ˜

å¦‚æœä½ æœ‰å¤šä¸ªç³»ç»Ÿ/é¡¹ç›®ï¼Œå®ƒä»¬å¯èƒ½å…±äº«äº†ç›¸åŒçš„ Docker æ•°æ®å·åç§°ï¼ˆ`postgres_data`ï¼‰ï¼Œå¯¼è‡´ï¼š
- æ•°æ®æ··æ·†
- å¯åŠ¨åçœ‹åˆ°å…¶ä»–ç³»ç»Ÿçš„æ•°æ®
- æ•°æ®è¢«æ„å¤–è¦†ç›–

## ğŸ¯ è§£å†³æ–¹æ¡ˆï¼šä¸ºæ¯ä¸ªç³»ç»Ÿé…ç½®ç‹¬ç«‹æ•°æ®å·

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨é¡¹ç›®åç§°ä½œä¸ºæ•°æ®å·å‰ç¼€ï¼ˆæ¨èï¼‰

ä¿®æ”¹ `docker-compose.yml`ï¼Œå°†æ•°æ®å·åç§°æ”¹ä¸ºåŒ…å«é¡¹ç›®åç§°ï¼š

```yaml
volumes:
  nexus_orchestrator_postgres_data:  # æ·»åŠ é¡¹ç›®å‰ç¼€ï¼Œé¿å…å†²çª
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ä¸åŒçš„æ•°æ®åº“åç§°

åœ¨ `docker-compose.yml` ä¸­ä¿®æ”¹æ•°æ®åº“åç§°ï¼š

```yaml
environment:
  POSTGRES_DB: nexus_orchestrator_db  # æ·»åŠ é¡¹ç›®åç¼€
```

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ä¸åŒçš„ç«¯å£

é¿å…ç«¯å£å†²çªï¼š

```yaml
ports:
  - "5433:5432"  # æ”¹ä¸º 5433ï¼Œé¿å…ä¸å…¶ä»–ç³»ç»Ÿå†²çª
```

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šå¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¦‚æœæœ‰é‡è¦æ•°æ®ï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/jiacongdediannao/Desktop/æˆ‘çš„å·¥å…·ä»¥åŠé¡¹ç›®/é¡¹ç›®/é™†æ€»ai/nexus-agent-orchestrator

# å¤‡ä»½æ•°æ®åº“æ•°æ®
docker-compose exec postgres pg_dump -U nexus_user nexus_db > backup_$(date +%Y%m%d_%H%M%S).sql
```

### æ­¥éª¤ 2ï¼šåœæ­¢å½“å‰æœåŠ¡

```bash
docker-compose down
```

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹ç°æœ‰æ•°æ®å·

```bash
# æŸ¥çœ‹æ‰€æœ‰ PostgreSQL ç›¸å…³æ•°æ®å·
docker volume ls | grep postgres
```

### æ­¥éª¤ 4ï¼šä¿®æ”¹ docker-compose.yml

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªä¿®å¤åçš„é…ç½®æ–‡ä»¶ã€‚

## ğŸ“‹ ä¿®æ”¹åçš„é…ç½®

### docker-compose.yml çš„å…³é”®ä¿®æ”¹ï¼š

1. **æ•°æ®å·åç§°**ï¼š`postgres_data` â†’ `nexus_orchestrator_postgres_data`
2. **å®¹å™¨åç§°**ï¼šä¿æŒä¸å˜ `nexus-postgres`
3. **æ•°æ®åº“åç§°**ï¼šå¯é€‰ï¼Œä¿æŒ `nexus_db` æˆ–æ”¹ä¸º `nexus_orchestrator_db`
4. **ç«¯å£**ï¼šä¿æŒ `5432`ï¼ˆå¦‚æœå†²çªå¯æ”¹ä¸º `5433`ï¼‰

## ğŸ” æ£€æŸ¥å…¶ä»–ç³»ç»Ÿçš„é…ç½®

### æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç³»ç»Ÿä½¿ç”¨ç›¸åŒé…ç½®ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿è¡Œä¸­çš„ PostgreSQL å®¹å™¨
docker ps -a | grep postgres

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·
docker volume ls

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i:5432
```

## ğŸ¯ ä¸ºä¸åŒç³»ç»Ÿåˆ†é…ç‹¬ç«‹é…ç½®

### ç³»ç»Ÿ 1ï¼šNexus Agent Orchestrator
- **æ•°æ®å·**ï¼š`nexus_orchestrator_postgres_data`
- **æ•°æ®åº“å**ï¼š`nexus_db`
- **ç«¯å£**ï¼š`5432`

### ç³»ç»Ÿ 2ï¼šNewAPIï¼ˆå¦‚æœæœ‰ï¼‰
- **æ•°æ®å·**ï¼š`newapi_postgres_data`
- **æ•°æ®åº“å**ï¼š`newapi_db`
- **ç«¯å£**ï¼š`5433`

### ç³»ç»Ÿ 3ï¼šå…¶ä»–ç³»ç»Ÿ
- **æ•°æ®å·**ï¼š`{é¡¹ç›®å}_postgres_data`
- **æ•°æ®åº“å**ï¼š`{é¡¹ç›®å}_db`
- **ç«¯å£**ï¼š`5434`ï¼ˆä¾æ­¤ç±»æ¨ï¼‰

## ğŸ”„ è¿ç§»ç°æœ‰æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰

### å¦‚æœæ—§æ•°æ®å·æœ‰é‡è¦æ•°æ®ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# 2. åˆ›å»ºæ–°æ•°æ®å·
docker volume create nexus_orchestrator_postgres_data

# 3. ä¸´æ—¶å¯åŠ¨æ—§å®¹å™¨ï¼Œå¯¼å‡ºæ•°æ®
docker run --rm -v postgres_data:/old_data -v nexus_orchestrator_postgres_data:/new_data postgres:16-alpine sh -c "cp -r /old_data/* /new_data/"

# 4. ä½¿ç”¨æ–°é…ç½®å¯åŠ¨æœåŠ¡
docker-compose up -d
```

## âš¡ å¿«é€Ÿä¿®å¤ï¼ˆä½¿ç”¨æ–°é…ç½®ï¼‰

æˆ‘å·²ç»ä¿®æ”¹äº† `docker-compose.yml`ï¼Œç°åœ¨ï¼š

1. **åœæ­¢å½“å‰æœåŠ¡**ï¼š
```bash
docker-compose down
```

2. **ä½¿ç”¨æ–°é…ç½®å¯åŠ¨**ï¼š
```bash
docker-compose up -d
```

3. **éªŒè¯æ•°æ®å·éš”ç¦»**ï¼š
```bash
docker volume ls | grep nexus_orchestrator
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**ï¼šä¿®æ”¹å‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®
2. **ç«¯å£å†²çª**ï¼šå¦‚æœ 5432 ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦ä¿®æ”¹ç«¯å£æ˜ å°„
3. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` ä¸é…ç½®ä¸€è‡´
4. **å®¹å™¨åç§°**ï¼šå¦‚æœæœ‰å¤šä¸ªç³»ç»Ÿï¼Œç¡®ä¿å®¹å™¨åç§°ä¸åŒ

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `docker-compose.yml` - å¼€å‘ç¯å¢ƒé…ç½®
- `docker-compose.prod.yml` - ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆä¹Ÿéœ€è¦åŒæ ·ä¿®æ”¹ï¼‰

---

**ä¿®æ”¹æ—¶é—´**ï¼š2026-01-04


