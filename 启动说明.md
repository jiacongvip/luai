# 🚀 Nexus Agent Orchestrator 启动说明

## 📋 前置要求

### 必需软件
- **Node.js**: v18 或更高版本
- **Docker**: v20 或更高版本（用于运行数据库和后端服务）
- **Docker Compose**: v2.0 或更高版本
- **npm**: 通常随 Node.js 安装

### 环境变量
需要在项目根目录创建 `.env` 文件（如果不存在），包含以下变量：

```env
# Gemini API 密钥（必需）
GEMINI_API_KEY=your_gemini_api_key_here

# JWT 密钥（可选，有默认值）
JWT_SECRET=change-this-secret-key-in-production

# WebSocket URL（可选，前端使用）
VITE_WS_URL=ws://localhost:3001/ws

# API URL（可选，前端使用）
VITE_API_URL=http://localhost:3001/api
```

## 🎯 快速启动（推荐方式）

### 方式一：使用 Docker Compose（最简单）

这是推荐的方式，会自动启动数据库和后端服务：

```bash
# 1. 进入项目目录
cd nexus-agent-orchestrator

# 2. 启动后端服务（数据库 + API）
docker-compose up -d

# 3. 等待几秒让服务启动完成
sleep 5

# 4. 启动前端开发服务器
npm install  # 如果还没安装依赖
npm run dev
```

### 方式二：手动启动（分步执行）

```bash
# 1. 安装前端依赖
npm install

# 2. 启动后端服务（数据库 + API）
docker-compose up -d

# 3. 检查后端服务状态
docker-compose ps

# 4. 查看后端日志（可选）
docker-compose logs -f backend

# 5. 在另一个终端窗口启动前端
npm run dev
```

## 📍 访问地址

启动成功后，在浏览器中访问：

| 服务 | 地址 | 说明 |
|------|------|------|
| **前端界面** | http://localhost:4000 | 主应用界面 |
| **后端 API** | http://localhost:3001/api | RESTful API |
| **WebSocket** | ws://localhost:3001/ws | 实时通信 |
| **数据库** | localhost:5432 | PostgreSQL |

## 🔍 检查服务状态

### 检查 Docker 服务

```bash
# 查看所有服务状态
docker-compose ps

# 应该看到以下服务运行：
# - nexus-postgres (数据库)
# - nexus-backend (后端 API)
```

### 检查端口占用

```bash
# 检查前端端口（4000）
lsof -i:4000

# 检查后端端口（3001）
lsof -i:3001

# 检查数据库端口（5432）
lsof -i:5432
```

### 查看服务日志

```bash
# 查看后端日志
docker-compose logs -f backend

# 查看数据库日志
docker-compose logs -f postgres

# 查看所有服务日志
docker-compose logs -f
```

## 🛠️ 常见问题排查

### 1. 端口被占用

**问题**: 端口 4000、3001 或 5432 已被占用

**解决**:
```bash
# 查找占用端口的进程
lsof -i:4000
lsof -i:3001

# 停止占用端口的进程，或修改 docker-compose.yml 中的端口映射
```

### 2. Docker 服务启动失败

**问题**: `docker-compose up` 报错

**解决**:
```bash
# 停止所有服务
docker-compose down

# 清理并重新启动
docker-compose down -v
docker-compose up -d

# 查看详细错误信息
docker-compose logs backend
```

### 3. 前端无法连接后端

**问题**: 前端显示连接错误

**解决**:
1. 确认后端服务正在运行: `docker-compose ps`
2. 检查后端日志: `docker-compose logs backend`
3. 确认环境变量 `VITE_API_URL` 正确设置
4. 检查浏览器控制台的错误信息

### 4. 数据库连接失败

**问题**: 后端无法连接数据库

**解决**:
```bash
# 检查数据库服务状态
docker-compose ps postgres

# 重启数据库服务
docker-compose restart postgres

# 查看数据库日志
docker-compose logs postgres
```

### 5. 缺少环境变量

**问题**: `GEMINI_API_KEY` 未设置

**解决**:
```bash
# 创建 .env 文件
echo "GEMINI_API_KEY=your_api_key_here" > .env

# 重启后端服务以加载新环境变量
docker-compose restart backend
```

## 🔄 重启服务

### 重启所有服务
```bash
docker-compose restart
```

### 重启特定服务
```bash
# 重启后端
docker-compose restart backend

# 重启数据库
docker-compose restart postgres
```

### 完全停止并清理
```bash
# 停止所有服务
docker-compose down

# 停止并删除数据卷（⚠️ 会删除数据库数据）
docker-compose down -v
```

## 📝 开发模式说明

### 后端开发模式
- 后端运行在 Docker 容器中，使用 `tsx watch` 实现热重载
- 修改 `backend/src/` 下的代码会自动重启
- 查看实时日志: `docker-compose logs -f backend`

### 前端开发模式
- 前端运行在本地，使用 Vite 开发服务器
- 支持热模块替换（HMR）
- 修改代码后浏览器自动刷新

## 🎨 功能特性

- ✅ **实时聊天**: 支持 SSE 流式响应和 WebSocket 双向通信
- ✅ **多 Agent 管理**: 创建和管理多个 AI Agent
- ✅ **会话管理**: 保存和管理聊天历史
- ✅ **项目管理**: 上下文数据管理
- ✅ **用户认证**: JWT 身份验证
- ✅ **日志系统**: 本地日志记录和导出

## 📞 需要帮助？

如果遇到问题：
1. 查看服务日志: `docker-compose logs -f`
2. 检查环境变量配置
3. 确认所有端口未被占用
4. 尝试重启所有服务: `docker-compose restart`

---

**最后更新**: 2026-01-04
**版本**: 1.0.0

